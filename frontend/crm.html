<!-- frontend/crm/index.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KIT8 CRM - –ö–æ–Ω—Ç–∞–∫—Ç—ã</title>
    <!-- –û–±—â–∏–µ —Å—Ç–∏–ª–∏ -->
    <link rel="stylesheet" href="/shared/styles.css">
    <!-- –°—Ç–∏–ª–∏ CRM -->
    <link rel="stylesheet" href="/crm/styles.css">
</head>
<body>
    <div class="container">
        <!-- –®–∞–ø–∫–∞ -->
        <div class="header">
            <div class="logo">
                <div class="logo-icon">üêã</div>
                <div class="logo-text">
                    <h1>KIT8 CRM</h1>
                    <div class="tagline">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏ –∏ —Å–¥–µ–ª–∫–∞–º–∏</div>
                </div>
            </div>

            <div class="stats">
                <div class="stat-card">
                    <div class="stat-value" id="contacts-count">0</div>
                    <div class="stat-label">–ö–æ–Ω—Ç–∞–∫—Ç–æ–≤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="deals-count">0</div>
                    <div class="stat-label">–°–¥–µ–ª–æ–∫</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="revenue-count">0</div>
                    <div class="stat-label">–û–±–æ—Ä–æ—Ç</div>
                </div>
            </div>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <div class="main-content">
            <!-- –°–ø–∏—Å–æ–∫ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ -->
            <div class="contacts-section">
                <div class="section-header">
                    <h2>–ö–æ–Ω—Ç–∞–∫—Ç—ã</h2>
                    <div>
                        <a href="/deals.html" class="btn" style="background: #8B5CF6; margin-right: 10px;">
                            üìä –ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–¥–µ–ª–∫–∞–º
                        </a>
                        <button class="btn" id="refresh-contacts">
                            üîÑ –û–±–Ω–æ–≤–∏—Ç—å
                        </button>
                    </div>
                </div>

                <div id="contacts-container">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤...</p>
                    </div>
                </div>
            </div>

            <!-- –°–∞–π–¥–±–∞—Ä -->
            <div class="sidebar">
                <!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–∞ -->
                <div class="add-contact-form">
                    <h3 class="form-title">–î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç</h3>

                    <div id="form-message"></div>

                    <div class="form-group">
                        <label for="first-name">–ò–º—è *</label>
                        <input type="text" id="first-name" class="form-input" placeholder="–ò–≤–∞–Ω" required>
                    </div>

                    <div class="form-group">
                        <label for="last-name">–§–∞–º–∏–ª–∏—è</label>
                        <input type="text" id="last-name" class="form-input" placeholder="–ü–µ—Ç—Ä–æ–≤">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="email">Email *</label>
                            <input type="email" id="email" class="form-input" placeholder="ivan@example.com" required>
                        </div>

                        <div class="form-group">
                            <label for="phone">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                            <input type="tel" id="phone" class="form-input" placeholder="+7 999 123-45-67">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="company">–ö–æ–º–ø–∞–Ω–∏—è</label>
                            <input type="text" id="company" class="form-input" placeholder="–û–û–û –†–æ–º–∞—à–∫–∞">
                        </div>

                        <div class="form-group">
                            <label for="position">–î–æ–ª–∂–Ω–æ—Å—Ç—å</label>
                            <input type="text" id="position" class="form-input" placeholder="–î–∏—Ä–µ–∫—Ç–æ—Ä">
                        </div>
                    </div>

                    <button class="btn btn-success" id="add-contact-btn">
                        ‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç
                    </button>
                </div>

                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                <div class="add-contact-form">
                    <h3 class="form-title">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                    <p style="color: #6B7280; font-size: 0.9rem; line-height: 1.5;">
                        –≠—Ç–∞ CRM —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ä–µ–∞–ª—å–Ω–æ–π –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö PostgreSQL.
                        –í—Å–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∏ –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ REST API.
                    </p>
                    <div style="margin-top: 15px; padding: 10px; background: #F3F4F6; border-radius: 8px;">
                        <div style="font-size: 0.8rem; color: #6B7280; margin-bottom: 5px;">API Endpoints:</div>
                        <div style="font-family: monospace; font-size: 0.75rem; color: #3B82F6;">
                            GET /api/crm/contacts<br>
                            POST /api/crm/contacts<br>
                            GET /api/crm/stats
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            ¬© 2024 KIT8 Platform | –ö–æ–º–ø–∞–Ω–∏—è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–π
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <div id="edit-modal">
        <div class="modal-content">
            <div style="padding: 25px; border-bottom: 2px solid #E2E8F0; display: flex; justify-content: space-between; align-items: center;">
                <h3 style="color: #1E3A8A; font-size: 1.3rem;">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç</h3>
                <button id="close-edit-modal" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #6B7280;">√ó</button>
            </div>

            <div style="padding: 25px;">
                <input type="hidden" id="edit-contact-id">

                <div id="edit-form-message"></div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div>
                        <label style="display: block; color: #4B5563; font-size: 0.9rem; margin-bottom: 5px; font-weight: 500;">–ò–º—è *</label>
                        <input type="text" id="edit-first-name" class="form-input" placeholder="–ò–≤–∞–Ω" required>
                    </div>

                    <div>
                        <label style="display: block; color: #4B5563; font-size: 0.9rem; margin-bottom: 5px; font-weight: 500;">–§–∞–º–∏–ª–∏—è</label>
                        <input type="text" id="edit-last-name" class="form-input" placeholder="–ü–µ—Ç—Ä–æ–≤">
                    </div>
                </div>

                <div style="margin-bottom: 20px;">
                    <label style="display: block; color: #4B5563; font-size: 0.9rem; margin-bottom: 5px; font-weight: 500;">Email *</label>
                        <input type="email" id="edit-email" class="form-input" placeholder="ivan@example.com" required>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div>
                        <label style="display: block; color: #4B5563; font-size: 0.9rem; margin-bottom: 5px; font-weight: 500;">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                        <input type="tel" id="edit-phone" class="form-input" placeholder="+7 999 123-45-67">
                    </div>

                    <div>
                        <label style="display: block; color: #4B5563; font-size: 0.9rem; margin-bottom: 5px; font-weight: 500;">–ö–æ–º–ø–∞–Ω–∏—è</label>
                        <input type="text" id="edit-company" class="form-input" placeholder="–û–û –†–æ–º–∞—à–∫–∞">
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div>
                        <label style="display: block; color: #4B5563; font-size: 0.9rem; margin-bottom: 5px; font-weight: 500;">–î–æ–ª–∂–Ω–æ—Å—Ç—å</label>
                        <input type="text" id="edit-position" class="form-input" placeholder="–î–∏—Ä–µ–∫—Ç–æ—Ä">
                    </div>

                    <div>
                        <label style="display: block; color: #4B5563; font-size: 0.9rem; margin-bottom: 5px; font-weight: 500;">–¢–µ–≥–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</label>
                        <input type="text" id="edit-tags" class="form-input" placeholder="–≤–∞–∂–Ω—ã–π, –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π, VIP">
                    </div>
                </div>

                <div id="contact-deals" style="margin-bottom: 25px; padding: 15px; background: #F9FAFB; border-radius: 8px;">
                    <!-- –ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è —Å–¥–µ–ª–∫–∏ –∫–æ–Ω—Ç–∞–∫—Ç–∞ -->
                </div>

                <div style="display: flex; gap: 15px;">
                    <button class="btn btn-success" id="save-contact-btn" style="flex: 1;">
                        üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                    </button>
                    <button class="btn" id="delete-contact-btn" style="background: #EF4444; flex: 1;">
                        üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç
                    </button>
                    <button class="btn" id="cancel-edit-btn" style="background: #6B7280; flex: 0.5;">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º API –º–æ–¥—É–ª—å –∫–∞–∫ ES6 –º–æ–¥—É–ª—å -->
    <script type="module">
        import apiClient from '/shared/api.js';
        window.apiClient = apiClient;
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º Header.js –∫–∞–∫ –æ–±—ã—á–Ω—ã–π —Å–∫—Ä–∏–ø—Ç
        document.addEventListener('DOMContentLoaded', () => {
            const headerScript = document.createElement('script');
            headerScript.src = '/shared/components/Header.js';
            document.head.appendChild(headerScript);
            
            // –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ Header.js —Å–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä
            headerScript.onload = function() {
                new window.KIT8Header('header-container');
            };

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –ª–æ–≥–∏–∫—É CRM
            const crmScript = document.createElement('script');
            crmScript.src = '/crm/app.js';
            document.head.appendChild(crmScript);
        });
    </script>

    <script>
        // –ü—Ä–∏–≤—è–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        document.addEventListener('DOMContentLoaded', () => {
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            document.getElementById('close-edit-modal').addEventListener('click', () => {
                window.crmApp.closeEditModal();
            });

            document.getElementById('cancel-edit-btn').addEventListener('click', () => {
                window.crmApp.closeEditModal();
            });

            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
            document.getElementById('save-contact-btn').addEventListener('click', () => {
                window.crmApp.saveContactChanges();
            });

            // –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞
            document.getElementById('delete-contact-btn').addEventListener('click', () => {
                window.crmApp.deleteContact();
            });

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
            document.getElementById('refresh-contacts').addEventListener('click', () => {
                window.crmApp.loadContacts();
            });

            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞
            document.getElementById('add-contact-btn').addEventListener('click', () => {
                window.crmApp.addContact();
            });
        });
    </script>
</body>
</html>